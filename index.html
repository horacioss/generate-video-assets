<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Generator</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>Video Assets Generator</h1>
    <div>
        <div class="input-group-small">
            <label for="videoTitle">Título del video:</label>
            <input type="text" id="videoTitle" required placeholder="Ingrese el título del video">
        </div>
        <div class="input-group-small">
            <div id="status"></div>
        </div>
    <div class="body-container">
        <div class="form-container">
            <h2>Generar audio e imágenes</h2>
            <div class="input-group">
                <label for="scriptFromChatGPT">Guion de Chat-GPT:</label>
                <textarea type="text" id="scriptFromChatGPT" 
                    placeholder="Escena1&#10Storyteller: ...&#10ImagePrompt1: ..."></textarea>
            </div>
            <div class="input-group">
                <label for="imageAspectRatio">Tipo de imagen para el video: </label>
                <select id="imageAspectRatio">
                    <option value="IMAGE_ASPECT_RATIO_LANDSCAPE">Horizontal</option>
                    <option value="IMAGE_ASPECT_RATIO_PORTRAIT">Vertical</option>
                </select>
            </div>
            <button onclick="startGeneration()">Generate</button>
        </div>
        <div class="form-container">
            <h2>Generar solo audio</h2>
            <div class="input-group">
                <label for="soloAudioScript">Guion:</label>
                <textarea id="soloAudioScript" placeholder=""></textarea>
            </div>
            <button onclick="startAudioGeneration()">Generar Audio</button>
        </div>
        <div class="form-container">
            <h2>Generar solo imágenes</h2>
            <div class="input-group">
                <label for="soloImagePrompts">Prompts de las imágenes:</label>
                <textarea id="soloImagePrompts" placeholder="ImagePrompt1: ...&#10&#10ImagePrompt2: ..."></textarea>
            </div>
            <div class="input-group">
                <label for="soloImageAspectRatio">Tipo de imagen para el video: </label>
                <select id="soloImageAspectRatio">
                    <option value="IMAGE_ASPECT_RATIO_LANDSCAPE">Horizontal</option>
                    <option value="IMAGE_ASPECT_RATIO_PORTRAIT">Vertical</option>
                </select>
            </div>
            <button onclick="startImageGeneration()">Generar Imágenes</button>
        </div>
    </div>

    <script>
        async function startGeneration() {
            const videoTitle = document.getElementById('videoTitle').value;
            const scriptFromChatGPT = document.getElementById('scriptFromChatGPT').value;
            const imageFXToken = document.getElementById('imageFXToken').value;
            const imageAspectRatio = document.getElementById('imageAspectRatio').value;

            if (!videoTitle) {
                alert('Por favor ingrese un título para el video.');
                return;
            }

            const status = document.getElementById('status');

            status.style.background = '#fff3cd';
            status.innerHTML = 'Generación de contenido en proceso...';

            try {
                const serverUrl = window.location.origin;
                const response = await fetch(`${serverUrl}/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        title: videoTitle,
                        scriptFromChatGPT: scriptFromChatGPT,
                        imageFXToken: imageFXToken,
                        imageAspectRatio: imageAspectRatio
                    })
                });

                // Check if the response is JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Server returned non-JSON response');
                }

                const result = await response.json();

                if (result.success) {
                    status.style.background = '#d4edda';
                    status.innerHTML = '¡Generación completada con éxito!';
                } else {
                    status.style.background = '#f8d7da';
                    status.innerHTML = `Error: ${result.error}`;
                }
            } catch (error) {
                console.error('Error en la generación del contenido:', error);
                status.style.background = '#f8d7da';
                status.innerHTML = `Error: ${error.message}`;
            }
        }

        async function startAudioGeneration() {
            const soloAudioScript = document.getElementById('soloAudioScript').value;
            const videoTitle = document.getElementById('videoTitle').value;
            const status = document.getElementById('status');

            if (videoTitle.trim() === '' || soloAudioScript.trim() === '') {
                alert('Por favor ingrese un título y un guion para el video.');
                return;
            }

            status.style.background = '#fff3cd';
            status.innerHTML = 'Generación de audio en proceso...';

            try {
                const serverUrl = window.location.origin;
                const response = await fetch(`${serverUrl}/generate/audio`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        title: videoTitle.trim(),
                        script: soloAudioScript.trim()
                    })
                });

                const result = await response.json();

                if (result.success) {
                    status.style.background = '#d4edda';
                    status.innerHTML = '¡Generación de audio completada con éxito!';
                } else {
                    status.style.background = '#f8d7da';
                    status.innerHTML = `Error: ${result.error}`;
                }
            } catch (error) {
                console.error('Error en la generación del audio:', error);
                status.style.background = '#f8d7da';
                status.innerHTML = `Error: ${error.message}`;
            }
        }

        async function startImageGeneration() {
            const title = document.getElementById('videoTitle').value;
            const soloImagePrompts = document.getElementById('soloImagePrompts').value;
            const soloImageAspectRatio = document.getElementById('soloImageAspectRatio').value;
            const status = document.getElementById('status');

            if (title.trim() === '') {
                alert('Por favor ingrese un título para el video.');
                return;
            }

            status.style.background = '#fff3cd';
            status.innerHTML = 'Generación de imágenes en proceso...';

            try {
                const serverUrl = window.location.origin;
                const response = await fetch(`${serverUrl}/generate/images`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        prompts: soloImagePrompts,
                        aspectRatio: soloImageAspectRatio
                    })
                });

                const result = await response.json();

                if (result.success) {
                    status.style.background = '#d4edda';
                    status.innerHTML = '¡Generación de imágenes completada con éxito!';
                } else {
                    status.style.background = '#f8d7da';
                    status.innerHTML = `Error: ${result.error}`;
                }
            } catch (error) {
                console.error('Error en la generación de imágenes:', error);
                status.style.background = '#f8d7da';
                status.innerHTML = `Error: ${error.message}`;
            }
        }
    </script>
</body>

</html>